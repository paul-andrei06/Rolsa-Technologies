@model RolsaTechnologies.Models.ScheduleConsultation

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>ScheduleConsultation</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <!-- Scheduled Date and Time input -->
            <div class="form-group">
                <label asp-for="ScheduledDate" class="control-label"></label>
                <input asp-for="ScheduledDate" type="datetime-local" class="form-control" />
                <span asp-validation-for="ScheduledDate" class="text-danger"></span>
            </div>

            <!-- Contact Method dropdown -->
            <div class="form-group">
                <label asp-for="ContactMethod" class="control-label"></label>
                <select asp-for="ContactMethod" class="form-control" id="contactMethod" onchange="toggleContactFields()">
                    <option value="">Select Contact Method</option>
                    <option value="Email">Email</option>
                    <option value="Mobile">Mobile</option>
                </select>
                <span asp-validation-for="ContactMethod" class="text-danger"></span>
            </div>

            <!-- Mobile input field (Initially hidden) -->
            <div class="form-group" id="mobileField" style="display:none;">
                <label asp-for="Mobile" class="control-label"></label>
                <input asp-for="Mobile" class="form-control" />
                <span asp-validation-for="Mobile" class="text-danger"></span>
            </div>

            <!-- Contact Email field (Initially hidden) -->
            <div class="form-group" id="contactEmailField" style="display:none;">
                <label asp-for="ContactEmail" class="control-label"></label>
                <input asp-for="ContactEmail" class="form-control" readonly />
                <span asp-validation-for="ContactEmail" class="text-danger"></span>
            </div>

            <!-- Notes input -->
            <div class="form-group">
                <label asp-for="Notes" class="control-label"></label>
                <input asp-for="Notes" class="form-control" />
                <span asp-validation-for="Notes" class="text-danger"></span>
            </div>

            <!-- Submit button -->
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>

        <!-- JavaScript to handle dynamic showing/hiding fields -->
        <script type="text/javascript">
            function toggleContactFields() {
                // Get selected contact method
                var contactMethod = document.getElementById("contactMethod").value;

                // Hide both Mobile and ContactEmail fields by default
                document.getElementById("mobileField").style.display = "none";
                document.getElementById("contactEmailField").style.display = "none";

                // Show the appropriate field based on the selected contact method
                if (contactMethod === "Mobile") {
                    document.getElementById("mobileField").style.display = "block";
                } else if (contactMethod === "Email") {
                    document.getElementById("contactEmailField").style.display = "block";

                    // Automatically populate the ContactEmail field with the logged-in user's email (assumed available in a variable)
                    var loggedInUserEmail = '@User.Identity.Name';  // Ensure this is the correct way to retrieve the email in your system
                    document.getElementById("ContactEmail").value = loggedInUserEmail;
                }
            }
        </script>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
